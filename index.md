

<html>
<head>
<title>ProcessAct_D.thy</title>
</head>
<body bgcolor="#ffffff">



<pre><font color="#333333"><span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   1 </font></span><font color="#cc0000">(*</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   2 </font></span><font color="#cc0000">These basic operations on processes of ARINC 653 are first created by </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   3 </font></span><font color="#cc0000">  ZHANG Feng from Nanyang Technological University.</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   4 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">   5 </font></span><font color="#cc0000">And Liang Jin from Beihang University adds some functions </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   6 </font></span><font color="#cc0000">*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   7 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   8 </font></span><font color="#006699"><strong>theory</strong></font> ProcessAct_D
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">   9 </font></span><font color="#009966"><strong>imports</strong></font> <font color="#ff00cc">&quot;ReadyQue_D&quot;</font> <font color="#ff00cc">&quot;WaitQue_D&quot;</font> suspQue_D <font color="#ff00cc">&quot;../../Scheduler/Design_Sched/Scheduler_D&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  10 </font></span><font color="#009966"><strong>begin</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  11 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  12 </font></span><font color="#cc0000">(*abstract scheduler*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  13 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  14 </font></span><font color="#006699"><strong>definition</strong></font> schedProc_Abs <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  15 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &rArr; PART_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  16 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &rArr; (PART_ID_TYPE &#8640; PROC_ID_TYPE) &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  17 </font></span><font color="#ff00cc">    (PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &times; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  18 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &times; PROC_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  19 </font></span>  <font color="#ff00cc">&quot;schedProc_Abs f_readyQ part_id f_procSta f_curProc &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  20 </font></span><font color="#ff00cc">  let curProc_id = the(f_curProc part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  21 </font></span><font color="#ff00cc">      setCurRun2Ready = (case f_procSta (part_id, curProc_id) of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  22 </font></span><font color="#ff00cc">        Some RUNNING &rArr; setProcSta' f_procSta (part_id, curProc_id) READY |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  23 </font></span><font color="#ff00cc">        _ &rArr; f_procSta) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  24 </font></span><font color="#ff00cc">  (f_readyQ, setCurRun2Ready, schedAlgRT_D f_readyQ part_id)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  25 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  26 </font></span><font color="#006699"><strong>definition</strong></font> schedule_Abs <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  27 </font></span>  <font color="#ff00cc">&quot;schedule_Abs s core_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  28 </font></span><font color="#ff00cc">  (let t = timer_' s; newPartID = schedPart core_id (int t);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  29 </font></span><font color="#ff00cc">      f_readyQ = readyQue (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  30 </font></span><font color="#ff00cc">      f_procSta = procSta (procs_' s); f_curProc = curProc (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  31 </font></span><font color="#ff00cc">      sched_proc_newPart = schedProc_Abs f_readyQ newPartID f_procSta f_curProc in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  32 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  33 </font></span><font color="#ff00cc">      &#10631;curPart := (curPart(partitions_' s))(core_id := Some newPartID),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  34 </font></span><font color="#ff00cc">      curProc := (curProc (partitions_' s))(newPartID := Some (snd(snd sched_proc_newPart))),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  35 </font></span><font color="#ff00cc">      readyQue := fst sched_proc_newPart&#10632;,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  36 </font></span><font color="#ff00cc">    procs_' := (procs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  37 </font></span><font color="#ff00cc">      &#10631;procSta := setProcSta' (fst (snd sched_proc_newPart)) (newPartID, (snd(snd sched_proc_newPart))) RUNNING&#10632;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  38 </font></span><font color="#ff00cc">    &#10632;)&quot;</font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  39 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  40 </font></span><font color="#006699"><strong>definition</strong></font> schedProc_Abs2 <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  41 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &rArr; PART_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  42 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &rArr; (PART_ID_TYPE &#8640; PROC_ID_TYPE) &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  43 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &times; PROC_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  44 </font></span>  <font color="#ff00cc">&quot;schedProc_Abs2 f_readyQ part_id f_procSta f_curProc &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  45 </font></span><font color="#ff00cc">  let curProc_id = the(f_curProc part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  46 </font></span><font color="#ff00cc">      setCurRun2Ready = (case f_procSta (part_id, curProc_id) of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  47 </font></span><font color="#ff00cc">        Some RUNNING &rArr; setProcSta' f_procSta (part_id, curProc_id) READY |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  48 </font></span><font color="#ff00cc">        _ &rArr; f_procSta) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  49 </font></span><font color="#ff00cc">  (setCurRun2Ready, schedAlgRT_D f_readyQ part_id)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  50 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  51 </font></span><font color="#006699"><strong>definition</strong></font> schedule_Abs2 <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  52 </font></span>  <font color="#ff00cc">&quot;schedule_Abs2 s core_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  53 </font></span><font color="#ff00cc">  (let t = timer_' s; newPartID = schedPart core_id (int t);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  54 </font></span><font color="#ff00cc">      f_readyQ = readyQue (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  55 </font></span><font color="#ff00cc">      f_procSta = procSta (procs_' s); f_curProc = curProc (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  56 </font></span><font color="#ff00cc">      sched_proc_newPart = schedProc_Abs2 f_readyQ newPartID f_procSta f_curProc in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  57 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  58 </font></span><font color="#ff00cc">      &#10631;curPart := (curPart(partitions_' s))(core_id := Some newPartID),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  59 </font></span><font color="#ff00cc">      curProc := (curProc (partitions_' s))(newPartID := Some (snd sched_proc_newPart))&#10632;,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  60 </font></span><font color="#ff00cc">    procs_' := (procs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  61 </font></span><font color="#ff00cc">      &#10631;procSta := setProcSta' (fst sched_proc_newPart) (newPartID, (snd sched_proc_newPart)) RUNNING&#10632;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  62 </font></span><font color="#ff00cc">    &#10632;)&quot;</font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  63 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  64 </font></span><font color="#006699"><strong>definition</strong></font> schedProc_Abs' <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  65 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &rArr; PART_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  66 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &rArr; (PART_ID_TYPE &#8640; PROC_ID_TYPE) &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  67 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &times; PROC_ID_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  68 </font></span>  <font color="#ff00cc">&quot;schedProc_Abs' f_readyQ part_id f_procSta f_curProc &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  69 </font></span><font color="#ff00cc">  let curProc_id = the(f_curProc part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  70 </font></span><font color="#ff00cc">      setCurRun2Ready = (case f_procSta (part_id, curProc_id) of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  71 </font></span><font color="#ff00cc">        Some RUNNING &rArr; setProcSta' f_procSta (part_id, curProc_id) READY |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  72 </font></span><font color="#ff00cc">        _ &rArr; f_procSta);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  73 </font></span><font color="#ff00cc">      new_proc_id = (SOME proc_id. f_procSta (part_id, proc_id) = Some READY) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  74 </font></span><font color="#ff00cc">  (setCurRun2Ready, new_proc_id)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  75 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  76 </font></span><font color="#006699"><strong>definition</strong></font> schedule_Abs' <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  77 </font></span>  <font color="#ff00cc">&quot;schedule_Abs' s core_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  78 </font></span><font color="#ff00cc">  (let t = timer_' s; newPartID = schedPart core_id (int t);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  79 </font></span><font color="#ff00cc">      f_readyQ = readyQue (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  80 </font></span><font color="#ff00cc">      f_procSta = procSta (procs_' s); f_curProc = curProc (partitions_' s); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  81 </font></span><font color="#ff00cc">      sched_proc_newPart = schedProc_Abs' f_readyQ newPartID f_procSta f_curProc in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  82 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  83 </font></span><font color="#ff00cc">      &#10631;curPart := (curPart(partitions_' s))(core_id := Some newPartID),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  84 </font></span><font color="#ff00cc">      curProc := (curProc (partitions_' s))(newPartID := Some (snd sched_proc_newPart))&#10632;,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  85 </font></span><font color="#ff00cc">    procs_' := (procs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  86 </font></span><font color="#ff00cc">      &#10631;procSta := setProcSta' (fst ( sched_proc_newPart)) (newPartID, (snd sched_proc_newPart)) RUNNING&#10632;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  87 </font></span><font color="#ff00cc">    &#10632;)&quot;</font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  88 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  89 </font></span><font color="#006699"><strong>definition</strong></font> set_addReadyTail_D <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  90 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &rArr; (PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  91 </font></span><font color="#ff00cc">    PART_ID_TYPE &rArr; PROC_ID_TYPE &rArr; PRIORITY_TYPE &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  92 </font></span><font color="#ff00cc">  (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &times;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  93 </font></span><font color="#ff00cc">    (PART_ID_TYPE &#8640; (PROC_ID_TYPE list list))&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  94 </font></span>  <font color="#ff00cc">&quot;set_addReadyTail_D proc_sta readyQ part_id proc_id proc_priority =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066">  95 </font></span><font color="#ff00cc">  (setProcSta' proc_sta (part_id, proc_id) READY, </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  96 </font></span><font color="#ff00cc">  readyAddTail_D readyQ part_id proc_priority proc_id)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  97 </font></span>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  98 </font></span><font color="#006699"><strong>definition</strong></font> set_addReadyHead_D <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000">  99 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 100 </font></span><font color="#ff00cc">    (PART_ID_TYPE &#8640; (PROC_ID_TYPE list list)) &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 101 </font></span><font color="#ff00cc">    PART_ID_TYPE &rArr; PROC_ID_TYPE &rArr; PRIORITY_TYPE &rArr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 102 </font></span><font color="#ff00cc">  (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PROC_STATE_TYPE) &times;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 103 </font></span><font color="#ff00cc">    (PART_ID_TYPE &#8640; (PROC_ID_TYPE list list))&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 104 </font></span>  <font color="#ff00cc">&quot;set_addReadyHead_D proc_sta readyQ part_id proc_id proc_priority =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 105 </font></span><font color="#ff00cc">  (setProcSta' proc_sta (part_id, proc_id) READY, </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 106 </font></span><font color="#ff00cc">  readyAddHead_D readyQ part_id proc_priority proc_id)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 107 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 108 </font></span><font color="#006699"><strong>primrec</strong></font> addList_Prio' <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 109 </font></span>  <font color="#ff00cc">&quot;(PART_ID_TYPE &times; PROC_ID_TYPE) list &rArr; (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PRIORITY_TYPE) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 110 </font></span><font color="#ff00cc">    PART_ID_TYPE &times; PROC_ID_TYPE &rArr; (PART_ID_TYPE &times; PROC_ID_TYPE) list&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 111 </font></span>  <font color="#ff00cc">&quot;addList_Prio' [] f_priority pp = [pp]&quot;</font><font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 112 </font></span>  <font color="#ff00cc">&quot;addList_Prio' (p#pl) f_priority pp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 113 </font></span><font color="#ff00cc">  (if the (f_priority p) &le; the (f_priority pp) then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 114 </font></span><font color="#ff00cc">      p # addList_Prio' pl f_priority pp</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 115 </font></span><font color="#ff00cc">  else pp # (p#pl))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 116 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 117 </font></span><font color="#006699"><strong>definition</strong></font> addList_Prio <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 118 </font></span>  <font color="#ff00cc">&quot;(RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list)) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 119 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PRIORITY_TYPE) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 120 </font></span><font color="#ff00cc">      RESRC_ID_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 121 </font></span><font color="#ff00cc">  (RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list))&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 122 </font></span>  <font color="#ff00cc">&quot;addList_Prio rp pp rsc_id proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 123 </font></span><font color="#ff00cc">  (let rsc_id_que = rp rsc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 124 </font></span><font color="#ff00cc">  case rsc_id_que of None &rArr; rp(rsc_id := Some [proc_id]) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 125 </font></span><font color="#ff00cc">                        _ &rArr;rp(rsc_id := Some (addList_Prio' (the rsc_id_que) pp proc_id)))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 126 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 127 </font></span><font color="#006699"><strong>definition</strong></font> addList_FIFO <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 128 </font></span>  <font color="#ff00cc">&quot;(RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list)) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 129 </font></span><font color="#ff00cc">      RESRC_ID_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 130 </font></span><font color="#ff00cc">  (RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list))&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 131 </font></span>  <font color="#ff00cc">&quot;addList_FIFO rp rsc_id pp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 132 </font></span><font color="#ff00cc">  (let rsc_id_que = rp rsc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 133 </font></span><font color="#ff00cc">  case rsc_id_que of None &rArr; rp(rsc_id := Some [pp]) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 134 </font></span><font color="#ff00cc">                        _ &rArr;rp(rsc_id := Some (the rsc_id_que @ [pp])))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 135 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 136 </font></span><font color="#006699"><strong>definition</strong></font> addList_FIFO_Prio <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 137 </font></span>  <font color="#ff00cc">&quot;(RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list)) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 138 </font></span><font color="#ff00cc">      (PART_ID_TYPE &times; PROC_ID_TYPE &#8640; PRIORITY_TYPE) &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 139 </font></span><font color="#ff00cc">      RESRC_ID_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; QUE_DISCIPLINE_TYPE &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 140 </font></span><font color="#ff00cc">  (RESRC_ID_TYPE &#8640; ((PART_ID_TYPE &times; PROC_ID_TYPE) list))&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 141 </font></span>  <font color="#ff00cc">&quot;addList_FIFO_Prio rp f_priority rsc_id pp disp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 142 </font></span><font color="#ff00cc">  (case disp of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 143 </font></span><font color="#ff00cc">    FIFO &rArr; addList_FIFO rp rsc_id pp |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 144 </font></span><font color="#ff00cc">    PRIORITY &rArr; addList_Prio rp f_priority rsc_id pp)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 145 </font></span> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 146 </font></span><font color="#006699"><strong>definition</strong></font> rscQPush <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 147 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; RESRC_ID_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 148 </font></span>  <font color="#ff00cc">&quot;rscQPush s rsc pp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 149 </font></span><font color="#ff00cc">  (let f_rscPendProcs_' = rscPendProcs_' s; f_rscQue = rscQue f_rscPendProcs_'; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 150 </font></span><font color="#ff00cc">      f_curPriority = curPriority (procs_' s);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 151 </font></span><font color="#ff00cc">      rsc_id_que = rscQue f_rscPendProcs_' rsc; disp = getRscQDis s rsc in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 152 </font></span><font color="#ff00cc">  case rsc of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 153 </font></span><font color="#ff00cc">    bbd _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO f_rscQue rsc pp&#10632;&#10632; |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 154 </font></span><font color="#ff00cc">    evt _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO f_rscQue rsc pp&#10632;&#10632; |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 155 </font></span><font color="#ff00cc"> interC _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO_Prio f_rscQue f_curPriority rsc pp disp&#10632;&#10632; |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 156 </font></span><font color="#ff00cc">    buf _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO_Prio f_rscQue f_curPriority rsc pp disp&#10632;&#10632; |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 157 </font></span><font color="#ff00cc">   sema _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO_Prio f_rscQue f_curPriority rsc pp disp&#10632;&#10632; |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 158 </font></span><font color="#ff00cc">userPlMtx _ &rArr; s&#10631;rscPendProcs_' := f_rscPendProcs_'&#10631;rscQue := addList_FIFO_Prio f_rscQue f_curPriority rsc pp disp&#10632;&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 159 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 160 </font></span><font color="#006699"><strong>definition</strong></font> rscQPop <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 161 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; RESRC_ID_TYPE  &rArr; 'a StaProc_scheme &times; (PART_ID_TYPE &times; PROC_ID_TYPE) option&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 162 </font></span>  <font color="#ff00cc">&quot;rscQPop s rsc_id  &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 163 </font></span><font color="#ff00cc">  let rsc_pend_procs = rscPendProcs_' s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 164 </font></span><font color="#ff00cc">      rsc_id_que = rscQue rsc_pend_procs rsc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 165 </font></span><font color="#ff00cc">  case rsc_id_que of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 166 </font></span><font color="#ff00cc">     None &rArr; (s, None) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 167 </font></span><font color="#ff00cc">  Some [] &rArr; (s, None) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 168 </font></span><font color="#ff00cc">   Some l &rArr; (s&#10631;rscPendProcs_' := rsc_pend_procs&#10631;rscQue := (rscQue rsc_pend_procs) (rsc_id := Some (tl (the rsc_id_que)))&#10632;&#10632;,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 169 </font></span><font color="#ff00cc">              Some (hd l))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 170 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 171 </font></span><font color="#cc0000">(*Del waitdiff and waitQue and tCounterRsc *)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 172 </font></span><font color="#006699"><strong>definition</strong></font> StopTCounter <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 173 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 174 </font></span>  <font color="#ff00cc">&quot;StopTCounter s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 175 </font></span><font color="#ff00cc">   (let t_waitDiff = getWaitDiff s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 176 </font></span><font color="#ff00cc">        s_waitQue_waitDiff_Del = waitDel_D s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 177 </font></span><font color="#ff00cc">        s_waitDiff_Del = rstWaitDiff s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 178 </font></span><font color="#ff00cc">        delT = if the(t_waitDiff) = -1 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 179 </font></span><font color="#ff00cc">                  s_waitDiff_Del</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 180 </font></span><font color="#ff00cc">               else s_waitQue_waitDiff_Del;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 181 </font></span><font color="#ff00cc">        delCterRsc =  stopCterRsc delT pp in delCterRsc)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 182 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 183 </font></span><font color="#006699"><strong>definition</strong></font> suspDiffDel_D <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 184 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 185 </font></span>  <font color="#ff00cc">&quot;suspDiffDel_D s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 186 </font></span><font color="#ff00cc">  (let cid = the (procBlngCore pp) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 187 </font></span><font color="#ff00cc">    s&#10631;rscPendProcs_' := (rscPendProcs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 188 </font></span><font color="#ff00cc">                                &#10631;suspDiff := (suspDiff(rscPendProcs_' s))(pp := None)&#10632;&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 189 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 190 </font></span><font color="#006699"><strong>definition</strong></font> cterSuspDel_D <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 191 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 192 </font></span>  <font color="#ff00cc">&quot;cterSuspDel_D s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 193 </font></span><font color="#ff00cc">    s&#10631;rscPendProcs_' := (rscPendProcs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 194 </font></span><font color="#ff00cc">                                &#10631;tCounterSusp := (tCounterSusp(rscPendProcs_' s))(pp := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 195 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 196 </font></span><font color="#cc0000">(*Del suspend info *)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 197 </font></span><font color="#006699"><strong>definition</strong></font> suspInfoAllDel_D <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 198 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 199 </font></span>  <font color="#ff00cc">&quot;suspInfoAllDel_D s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 200 </font></span><font color="#ff00cc">   (let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 201 </font></span><font color="#ff00cc">      s_suspQueDel = suspQueDel_D s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 202 </font></span><font color="#ff00cc">      s_suspQue_tCounterSusp_del = cterSuspDel_D s_suspQueDel pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 203 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 204 </font></span><font color="#ff00cc">      s_suspended_del = rstsuspProc s pp in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 205 </font></span><font color="#ff00cc">   case isInSuspQ s pp of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 206 </font></span><font color="#ff00cc">      True &rArr; s_suspQue_tCounterSusp_del |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 207 </font></span><font color="#ff00cc">     False &rArr; s_suspended_del             </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 208 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 209 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 210 </font></span><font color="#006699"><strong>primrec</strong></font> stopProcLTCtr <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 211 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme  &rArr; ((PART_ID_TYPE &times; PROC_ID_TYPE) list) &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 212 </font></span>  <font color="#ff00cc">&quot;stopProcLTCtr s [] = s&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 213 </font></span>  <font color="#ff00cc">&quot;stopProcLTCtr s (p#pl) = stopProcLTCtr (StopTCounter s p) pl&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 214 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 215 </font></span><font color="#006699"><strong>definition</strong></font> procAlone <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 216 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 217 </font></span>  <font color="#ff00cc">&quot;procAlone s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 218 </font></span><font color="#ff00cc">  (let proc_id_sta = procSta (procs_' s) pp in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 219 </font></span><font color="#ff00cc">  case proc_id_sta of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 220 </font></span><font color="#ff00cc">      Some READY &rArr; readyDel_s_D s (fst pp) (snd pp) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 221 </font></span><font color="#ff00cc">      Some WAITING &rArr; if isInWaitQ s pp then waitDel_D s pp</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 222 </font></span><font color="#ff00cc">                      else s |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 223 </font></span><font color="#ff00cc">      _ &rArr; s)&quot;</font>      
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 224 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 225 </font></span><font color="#006699"><strong>definition</strong></font> rstDeadline <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 226 </font></span>  <font color="#ff00cc">&quot;rstDeadline s pp  = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 227 </font></span><font color="#ff00cc">  s&#10631;procs_' := (procs_' s)&#10631;deadline := (deadline(procs_' s))(pp := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 228 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 229 </font></span><font color="#006699"><strong>definition</strong></font> rstPriority <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 230 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE  &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 231 </font></span>  <font color="#ff00cc">&quot;rstPriority s pp  =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 232 </font></span><font color="#ff00cc">  (let proc_sta = procs_' s in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 233 </font></span><font color="#ff00cc">  s&#10631;procs_' := proc_sta&#10631;curPriority := (curPriority proc_sta)(pp := None)&#10632;&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 234 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 235 </font></span><font color="#cc0000">(*comprising the operations on suspendSelf and suspend*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 236 </font></span><font color="#006699"><strong>definition</strong></font> procStop <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 237 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 238 </font></span>  <font color="#ff00cc">&quot;procStop s pp &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 239 </font></span><font color="#ff00cc">  let s_set_Dorm = setProcSta s pp DORMANT;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 240 </font></span><font color="#ff00cc">      s_set_Dorm_susp_del = if isSuspended s_set_Dorm pp then suspInfoAllDel_D s_set_Dorm pp else s_set_Dorm;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 241 </font></span><font color="#ff00cc">      s_set_Dorm_alone = procAlone s_set_Dorm_susp_del pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 242 </font></span><font color="#ff00cc">      s_set_waitQue_del = if procInRscQ s_set_Dorm_alone pp then rscQdelProc s_set_Dorm_alone pp else s_set_Dorm_alone;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 243 </font></span><font color="#ff00cc">      s_set_stopTct = StopTCounter s_set_waitQue_del pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 244 </font></span><font color="#ff00cc">      s_rstPrio = rstPriority s_set_stopTct pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 245 </font></span><font color="#ff00cc">      s_rstDdl = rstDeadline s_rstPrio pp</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 246 </font></span><font color="#ff00cc">       in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 247 </font></span><font color="#ff00cc">   s_rstDdl&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 248 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 249 </font></span><font color="#006699"><strong>function</strong></font> procLStop <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 250 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; (PART_ID_TYPE &times; PROC_ID_TYPE) set &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 251 </font></span>  <font color="#ff00cc">&quot;procLStop s ps =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 252 </font></span><font color="#ff00cc">  (let a_proc = SOME proc_id. proc_id &isin; ps;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 253 </font></span><font color="#ff00cc">      news = procStop s a_proc in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 254 </font></span><font color="#ff00cc">  if ps = {} then s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 255 </font></span><font color="#ff00cc">  else procLStop news (ps-{a_proc}))&quot;</font> <font color="#006699"><strong>by</strong></font> auto
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 256 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 257 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 258 </font></span><font color="#006699"><strong>definition</strong></font> procWaitSignal <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; TIMEOUT_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 259 </font></span>  <font color="#ff00cc">&quot;procWaitSignal s pp tout =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 260 </font></span><font color="#ff00cc">  (let s_alone = procAlone s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 261 </font></span><font color="#ff00cc">      s_addWQ = waitAdd_D s_alone pp in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 262 </font></span><font color="#ff00cc">  setProcSta s_addWQ pp WAITING)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 263 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 264 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 265 </font></span><font color="#006699"><strong>definition</strong></font> readyAdd <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 266 </font></span>  <font color="#ff00cc">&quot;readyAdd s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 267 </font></span><font color="#ff00cc">  (let f_readyQue = readyQue(partitions_' s); part_id = fst pp; proc_id = snd pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 268 </font></span><font color="#ff00cc">      prio = the(getPriority s pp); f_readyQue' = readyAddTail_D f_readyQue part_id prio proc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 269 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)&#10631;readyQue := f_readyQue'&#10632;&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 270 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 271 </font></span><font color="#006699"><strong>definition</strong></font> procReady <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 272 </font></span>  <font color="#ff00cc">&quot;procReady s pp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 273 </font></span><font color="#ff00cc">  (let s_alone = procAlone s pp; s_alone_rdAdd = readyAdd s_alone pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 274 </font></span><font color="#ff00cc">  s_alone_rdAdd_SetRd = setProcSta s_alone_rdAdd pp READY in s_alone_rdAdd_SetRd)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 275 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 276 </font></span><font color="#006699"><strong>primrec</strong></font> procsReady <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 277 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &rArr; (PROC_ID_TYPE list) &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 278 </font></span>  <font color="#ff00cc">&quot;procsReady s part_id [] = s&quot;</font><font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 279 </font></span>  <font color="#ff00cc">&quot;procsReady s part_id (p#pl) = (if the(suspended(rscPendProcs_' s)(part_id,p)) = True then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 280 </font></span><font color="#ff00cc">                             procsReady s part_id pl</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 281 </font></span><font color="#ff00cc">                          else  procsReady (procReady s (part_id,p)) part_id pl)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 282 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 283 </font></span><font color="#006699"><strong>definition</strong></font> readyAddHead <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 284 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 285 </font></span>  <font color="#ff00cc">&quot;readyAddHead s pp =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 286 </font></span><font color="#ff00cc">  (let f_readyQue = readyQue(partitions_' s); part_id = fst pp; proc_id = snd pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 287 </font></span><font color="#ff00cc">      prio = the(getPriority s pp); f_readyQue' = readyAddHead_D f_readyQue part_id prio proc_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 288 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)&#10631;readyQue := f_readyQue'&#10632;&#10632;)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 289 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 290 </font></span><font color="#006699"><strong>definition</strong></font> procReadyHead <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 291 </font></span>  <font color="#ff00cc">&quot;procReadyHead s pp = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 292 </font></span><font color="#ff00cc">  (let s_alone = procAlone s pp; s_alone_rdAdd = readyAddHead s_alone pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 293 </font></span><font color="#ff00cc">  s_alone_rdAdd_SetRd = setProcSta s_alone_rdAdd pp READY in s_alone_rdAdd_SetRd)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 294 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 295 </font></span><font color="#cc0000">(*the source code has a wakeup_time, but the 653 doesn't*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 296 </font></span><font color="#006699"><strong>definition</strong></font> procWkup <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 297 </font></span>  <font color="#ff00cc">&quot;procWkup s proc_id = procReady s proc_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 298 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 299 </font></span><font color="#006699"><strong>definition</strong></font> setAddWaitDiff <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 300 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; TIMEOUT_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 301 </font></span>  <font color="#ff00cc">&quot;setAddWaitDiff s proc_id tout = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 302 </font></span><font color="#ff00cc">  waitAdd_D (setWaitDiff s proc_id tout)  proc_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 303 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 304 </font></span><font color="#cc0000">(*For PERIODIC_WAIT*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 305 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 306 </font></span><font color="#006699"><strong>definition</strong></font> periodic_wait <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 307 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 308 </font></span>  <font color="#ff00cc">&quot;periodic_wait s core_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 309 </font></span><font color="#ff00cc">    let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 310 </font></span><font color="#ff00cc">        cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 311 </font></span><font color="#ff00cc">        cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 312 </font></span><font color="#ff00cc">        proc_sta = procs_' s;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 313 </font></span><font color="#ff00cc">        deadline_time = the(deadline(procs_' s)(the cur_part_id, the cur_proc_id))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 314 </font></span><font color="#ff00cc">    in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 315 </font></span><font color="#ff00cc">    if (the cur_proc_id) = HM_PROC_ID &or; getProcUserPLMtx s (the cur_part_id, the cur_proc_id) &ne; None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 316 </font></span><font color="#ff00cc">      (s, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 317 </font></span><font color="#ff00cc">    else if &not; isPeriodic s (the cur_part_id, the cur_proc_id) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 318 </font></span><font color="#ff00cc">      (s, INVALID_MODE)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 319 </font></span><font color="#ff00cc">    else if (Int.nat deadline_time &ge; INVALID_TIMEOUT_VALUE &or; deadline_time = INFINITE_TIMEOUT) then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 320 </font></span><font color="#ff00cc">      (s, INVALID_CONFIG)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 321 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 322 </font></span><font color="#ff00cc">      let</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 323 </font></span><font color="#ff00cc">         set_cur_proc_sta = setCurProcSta s core_id WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 324 </font></span><font color="#ff00cc">         s_alone = procAlone set_cur_proc_sta (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 325 </font></span><font color="#ff00cc">         proc_attr = getProcAttr s_alone (the cur_part_id, the cur_proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 326 </font></span><font color="#ff00cc">         process_period = (PROC_ATTR_TYPE.PERIOD(the proc_attr));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 327 </font></span><font color="#ff00cc">         cur_release_point = the(getRlsPoint s (the cur_part_id, the cur_proc_id));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 328 </font></span><font color="#ff00cc">         proc_capa = (PROC_ATTR_TYPE.TIME_CAPACITY(the proc_attr));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 329 </font></span><font color="#ff00cc">         next_release_point = (Int.nat process_period) + (Int.nat cur_release_point);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 330 </font></span><font color="#ff00cc">         s_setsta_rlsp = setRlsPoint s_alone (the cur_part_id, the cur_proc_id) (Int.int next_release_point);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 331 </font></span><font color="#ff00cc">         s_setsta_rlsp_ddl = setProcDDL s_setsta_rlsp (the cur_part_id, the cur_proc_id) (Int.int(Int.nat proc_capa + next_release_point));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 332 </font></span><font color="#ff00cc">        s_wait_add = waitAdd_D s_setsta_rlsp_ddl (the cur_part_id, the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 333 </font></span><font color="#ff00cc">      (schedule_Abs s_wait_add core_id, NO_ERROR)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 334 </font></span><font color="#ff00cc">  &quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 335 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 336 </font></span><font color="#006699"><strong>definition</strong></font> procWaitDealyedStart <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 337 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; DELAY_TIME_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 338 </font></span>  <font color="#ff00cc">&quot;procWaitDealyedStart s pp delayt &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 339 </font></span><font color="#ff00cc">  let s_alone = procAlone s pp;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 340 </font></span><font color="#ff00cc">     set_wait_add = setAddWaitDiff s_alone pp (Int.int delayt);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 341 </font></span><font color="#ff00cc">     set_wait_add_sta = setProcSta set_wait_add pp WAITING  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 342 </font></span><font color="#ff00cc">    set_wait_add_sta</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 343 </font></span><font color="#ff00cc">  &quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 344 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 345 </font></span><font color="#cc0000">(*for userMtx and PLMtx*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 346 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 347 </font></span><font color="#006699"><strong>definition</strong></font> createUserMutex <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 348 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE  &rArr; USER_PL_MUTEX_ID_TYPE &rArr; USER_PL_MUTEX_ATTR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 349 </font></span>  <font color="#ff00cc">&quot;createUserMutex s part_id umtx_id userMtx_attr &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 350 </font></span><font color="#ff00cc">  s&#10631;user_pl_Mtx_' := (user_pl_Mtx_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 351 </font></span><font color="#ff00cc">    &#10631;createdMtx := (createdMtx(user_pl_Mtx_' s))((part_id, umtx_id) := Some userMtx_attr),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 352 </font></span><font color="#ff00cc">    mtxLkCt := (mtxLkCt(user_pl_Mtx_' s))((part_id, umtx_id) := Some 0),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 353 </font></span><font color="#ff00cc">    mtxSta :=  (mtxSta(user_pl_Mtx_' s))((part_id, umtx_id) := Some AVAILABLE)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 354 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 355 </font></span><font color="#006699"><strong>definition</strong></font> createPLMutex <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 356 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme  &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 357 </font></span>  <font color="#ff00cc">&quot;createPLMutex s part_id &equiv; createUserMutex s part_id (-3) PLMtxAttr&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 358 </font></span>     
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 359 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_PREEMPT_LOCK_MUTEX <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 360 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; ('a STATE_scheme)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 361 </font></span>  <font color="#ff00cc">&quot;CREATE_PREEMPT_LOCK_MUTEX s cur_part_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 362 </font></span><font color="#ff00cc">  (let </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 363 </font></span><font color="#ff00cc">      umutex_name = USER_PL_MUTEX_ATTR_TYPE.MUTEX_NAME PLMtxAttr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 364 </font></span><font color="#ff00cc">      prio = USER_PL_MUTEX_ATTR_TYPE.MUTEX_PRIORITY PLMtxAttr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 365 </font></span><font color="#ff00cc">      que_disc = USER_PL_MUTEX_ATTR_TYPE.QUE_DISCIPLINE PLMtxAttr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 366 </font></span><font color="#ff00cc">      created_mtxs = size_set (getUserPLMtxsOfPart s cur_part_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 367 </font></span><font color="#ff00cc">    if created_mtxs &ge; MAX_NUM_OF_MUTEXES  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 368 </font></span><font color="#ff00cc">       s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 369 </font></span><font color="#ff00cc">    else if getBufIDByName s cur_part_id umutex_name &ne; None  then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 370 </font></span><font color="#ff00cc">        s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 371 </font></span><font color="#ff00cc">    else if prio &gt; MAX_PRIORITY_VALUE then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 372 </font></span><font color="#ff00cc">        s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 373 </font></span><font color="#ff00cc">    else if que_disc &ne; FIFO &or; que_disc &ne; PRIORITY then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 374 </font></span><font color="#ff00cc">        s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 375 </font></span><font color="#ff00cc">    else if  the(curMode(partitions_' s)cur_part_id) = NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 376 </font></span><font color="#ff00cc">        s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 377 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 378 </font></span><font color="#ff00cc">        let s_new = createPLMutex s cur_part_id in s_new</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 379 </font></span><font color="#ff00cc">  )&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 380 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 381 </font></span><font color="#cc0000">(*********)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 382 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 383 </font></span><font color="#cc0000">(*For this bool parameter: if TRUE then COLD_SART else WARM_START*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 384 </font></span><font color="#006699"><strong>definition</strong></font> partReInit <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &rArr; bool &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 385 </font></span>  <font color="#ff00cc">&quot;partReInit s part_id b &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 386 </font></span><font color="#ff00cc">  let cur_mode = case b of True &rArr; COLD_START | False &rArr; WARM_START in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 387 </font></span><font color="#ff00cc">  s&#10631;partitions_' := (partitions_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 388 </font></span><font color="#ff00cc">                      &#10631;curProc := (curProc(partitions_' s))(part_id := Some IDLE_PROC_ID),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 389 </font></span><font color="#ff00cc">                      schedSignal := (schedSignal(partitions_' s))[part_id := False],</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 390 </font></span><font color="#ff00cc">                      curMode := (curMode(partitions_' s))(part_id := Some cur_mode),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 391 </font></span><font color="#ff00cc">                      lockLvl := (lockLvl(partitions_' s))(part_id := None),</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 392 </font></span><font color="#ff00cc">                      readyQue := (readyQue(partitions_' s))(part_id := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 393 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 394 </font></span><font color="#cc0000">(*rsc clear*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 395 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 396 </font></span><font color="#cc0000">(*for example: </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 397 </font></span><font color="#cc0000">  'a: PROC_ID_TYPE</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 398 </font></span><font color="#cc0000">  'b: PART_ID_TYP*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 399 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 400 </font></span><font color="#006699"><strong>definition</strong></font> rangeClear1 <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;('a &#8640; 'b) &rArr; 'a &rArr; ('a &#8640; 'b)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 401 </font></span>  <font color="#ff00cc">&quot;rangeClear1 ab a &equiv; ab(a:=None)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 402 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 403 </font></span><font color="#006699"><strong>definition</strong></font> rangesClear1 <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;('a &#8640; 'b) &rArr; 'a set &rArr; ('a &#8640; 'b)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 404 </font></span>  <font color="#ff00cc">&quot;rangesClear1 ab as &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 405 </font></span><font color="#ff00cc">  THE newab. (&forall;a. case a&isin;as of True &rArr; newab a = None |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 406 </font></span><font color="#ff00cc">                              False &rArr; newab a = ab a)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 407 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 408 </font></span><font color="#006699"><strong>definition</strong></font> rangesClear2 <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;(('a &times; 'b) &#8640; 'c) &rArr; 'a &rArr; 'b set &rArr; (('a &times; 'b) &#8640; 'c)&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 409 </font></span>  <font color="#ff00cc">&quot;rangesClear2 abc a bs &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 410 </font></span><font color="#ff00cc">  THE newabc. (&forall;b. case b&isin;bs of True &rArr; newabc (a,b) = None |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 411 </font></span><font color="#ff00cc">                                  False &rArr; newabc (a,b) = abc (a,b))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 412 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 413 </font></span><font color="#006699"><strong>definition</strong></font> clearProcs <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; PART_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 414 </font></span>  <font color="#ff00cc">&quot;clearProcs s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 415 </font></span><font color="#ff00cc">  let procs = getProcsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 416 </font></span><font color="#ff00cc">  s&#10631;procs_' := (procs_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 417 </font></span><font color="#ff00cc">                &#10631;createdProcs := rangesClear2 (createdProcs(procs_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 418 </font></span><font color="#ff00cc">                procSta := rangesClear2 (procSta(procs_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 419 </font></span><font color="#ff00cc">                curPriority := rangesClear2 (curPriority(procs_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 420 </font></span><font color="#ff00cc">                deadline := rangesClear2 (deadline(procs_' s)) part_id procs&#10632;&#10632;&quot;</font>   
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 421 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 422 </font></span><font color="#006699"><strong>definition</strong></font> clearInterPorts <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 423 </font></span>  <font color="#ff00cc">&quot;clearInterPorts s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 424 </font></span><font color="#ff00cc">  let procs = getPortsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 425 </font></span><font color="#ff00cc">  s&#10631;interCom_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 426 </font></span><font color="#ff00cc">    (interCom_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 427 </font></span><font color="#ff00cc">      &#10631;createdPorts := rangesClear2 (createdPorts(interCom_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 428 </font></span><font color="#ff00cc">      samPortMsg := rangesClear2 (samPortMsg(interCom_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 429 </font></span><font color="#ff00cc">      quePortMsg := rangesClear2 (quePortMsg(interCom_' s)) part_id procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 430 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 431 </font></span><font color="#006699"><strong>definition</strong></font> clearBuffs <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 432 </font></span>  <font color="#ff00cc">&quot;clearBuffs s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 433 </font></span><font color="#ff00cc">  let procs = getBuffsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 434 </font></span><font color="#ff00cc">  s&#10631;buffer_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 435 </font></span><font color="#ff00cc">    (buffer_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 436 </font></span><font color="#ff00cc">      &#10631;createdBuf := rangesClear2 (createdBuf(buffer_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 437 </font></span><font color="#ff00cc">      bufmsgQue := rangesClear2 (bufmsgQue(buffer_' s)) part_id procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 438 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 439 </font></span><font color="#006699"><strong>definition</strong></font> clearBbds <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 440 </font></span>  <font color="#ff00cc">&quot;clearBbds s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 441 </font></span><font color="#ff00cc">  let procs = getBbdsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 442 </font></span><font color="#ff00cc">  s&#10631;blackBD_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 443 </font></span><font color="#ff00cc">    (blackBD_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 444 </font></span><font color="#ff00cc">      &#10631;createdBbd := rangesClear2 (createdBbd(blackBD_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 445 </font></span><font color="#ff00cc">      msgBbd := rangesClear2 (msgBbd(blackBD_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 446 </font></span><font color="#ff00cc">      emptyID := rangesClear2 (emptyID(blackBD_' s))part_id  procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 447 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 448 </font></span><font color="#006699"><strong>definition</strong></font> clearSemas <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 449 </font></span>  <font color="#ff00cc">&quot;clearSemas s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 450 </font></span><font color="#ff00cc">  let procs = getUserSemasOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 451 </font></span><font color="#ff00cc">  s&#10631;sema_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 452 </font></span><font color="#ff00cc">    (sema_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 453 </font></span><font color="#ff00cc">      &#10631;createdSema := rangesClear2 (createdSema(sema_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 454 </font></span><font color="#ff00cc">      maxValue := rangesClear2 (maxValue(sema_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 455 </font></span><font color="#ff00cc">      curValue := rangesClear2 (curValue(sema_' s)) part_id procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 456 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 457 </font></span><font color="#006699"><strong>definition</strong></font> clearEvnts <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 458 </font></span>  <font color="#ff00cc">&quot;clearEvnts s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 459 </font></span><font color="#ff00cc">  let procs = getEvntsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 460 </font></span><font color="#ff00cc">  s&#10631;event_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 461 </font></span><font color="#ff00cc">    (event_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 462 </font></span><font color="#ff00cc">      &#10631;createdEvent := rangesClear2 (createdEvent(event_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 463 </font></span><font color="#ff00cc">      eventSta := rangesClear2 (eventSta(event_' s)) part_id procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 464 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 465 </font></span><font color="#006699"><strong>definition</strong></font> clearUserMtxs <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 466 </font></span>  <font color="#ff00cc">&quot;clearUserMtxs s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 467 </font></span><font color="#ff00cc">  let procs = getUserPLMtxsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 468 </font></span><font color="#ff00cc">  s&#10631;user_pl_Mtx_' := </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 469 </font></span><font color="#ff00cc">    (user_pl_Mtx_' s)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 470 </font></span><font color="#ff00cc">      &#10631;createdMtx := rangesClear2 (createdMtx(user_pl_Mtx_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 471 </font></span><font color="#ff00cc">      mtxOwner := rangesClear2 (mtxOwner(user_pl_Mtx_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 472 </font></span><font color="#ff00cc">      mtxSta := rangesClear2 (mtxSta(user_pl_Mtx_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 473 </font></span><font color="#ff00cc">      mtxRtnPrio := rangesClear2 (mtxRtnPrio(user_pl_Mtx_' s)) part_id procs,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 474 </font></span><font color="#ff00cc">      mtxLkCt := rangesClear2 (mtxLkCt(user_pl_Mtx_' s)) part_id procs&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 475 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 476 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 477 </font></span><font color="#006699"><strong>definition</strong></font> clearRsrs <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 478 </font></span>  <font color="#ff00cc">&quot;clearRsrs s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 479 </font></span><font color="#ff00cc">  let s_clear0 = clearInterPorts s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 480 </font></span><font color="#ff00cc">      s_clear1 = clearBuffs s_clear0 part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 481 </font></span><font color="#ff00cc">      s_clear2 = clearBbds s_clear1 part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 482 </font></span><font color="#ff00cc">      s_clear3 = clearSemas s_clear2 part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 483 </font></span><font color="#ff00cc">      s_clear4 = clearEvnts s_clear3 part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 484 </font></span><font color="#ff00cc">      s_clear5 = clearUserMtxs s_clear4 part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 485 </font></span><font color="#ff00cc">  s_clear5&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 486 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 487 </font></span><font color="#cc0000">(**)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 488 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 489 </font></span><font color="#006699"><strong>definition</strong></font> <font color="#ff00cc">&quot;mainProcAttr &equiv; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 490 </font></span><font color="#ff00cc">  &#10631;PERIOD = -1,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 491 </font></span><font color="#ff00cc">  TIME_CAPACITY = Int.int MAIN_MAX_TIME_CAPACITY,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 492 </font></span><font color="#ff00cc">  ENTRY_POINT = 0,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 493 </font></span><font color="#ff00cc">  STACK_SZ = 1,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 494 </font></span><font color="#ff00cc">  BASE_PRIORITY = 1,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 495 </font></span><font color="#ff00cc">  DEADLINE = HARD,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 496 </font></span><font color="#ff00cc">  NAME = ''MAIN_PROC''&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 497 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 498 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_MAIN_PROCESS <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 499 </font></span>  <font color="#ff00cc">&quot;'a StaProc_sched_scheme &rArr; PART_ID_TYPE &rArr; 'a StaProc_sched_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 500 </font></span>  <font color="#ff00cc">&quot;CREATE_MAIN_PROCESS s part_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 501 </font></span><font color="#ff00cc">  (let cur_part_cfg = getPartByID part_id; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 502 </font></span><font color="#ff00cc">      cur_part_mod = getPartMode s part_id;   </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 503 </font></span><font color="#ff00cc">      s_created_new = createProc s (part_id, MAIN_PROC_ID) mainProcAttr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 504 </font></span><font color="#ff00cc">      s_created_new_prio =  setPriority s_created_new (part_id, MAIN_PROC_ID) (BASE_PRIORITY mainProcAttr);  </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 505 </font></span><font color="#ff00cc">      s_set_created_new = setProcSta s_created_new_prio (part_id, MAIN_PROC_ID) DORMANT in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 506 </font></span><font color="#ff00cc">  s_set_created_new)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 507 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 508 </font></span><font color="#006699"><strong>definition</strong></font> START_MAIN_PROCESS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 509 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 510 </font></span>  <font color="#ff00cc">&quot;START_MAIN_PROCESS s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 511 </font></span><font color="#ff00cc">  let s_setRlspt = setRlsPoint s (part_id, MAIN_PROC_ID) (Int.int (sysClk s));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 512 </font></span><font color="#ff00cc">      s_setRlspt_ddl = setProcDDL s_setRlspt (part_id, MAIN_PROC_ID) (Int.int(sysClk s + Int.nat(TIME_CAPACITY mainProcAttr)));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 513 </font></span><font color="#ff00cc">      s_setRlspt_ddl_start = procReady s_setRlspt_ddl (part_id, MAIN_PROC_ID)  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 514 </font></span><font color="#ff00cc">  s_setRlspt_ddl_start&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 515 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 516 </font></span><font color="#006699"><strong>definition</strong></font> CREATE_START_MAIN_PROCESS <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 517 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; PART_ID_TYPE &rArr; 'a StaProc_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 518 </font></span>  <font color="#ff00cc">&quot;CREATE_START_MAIN_PROCESS s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 519 </font></span><font color="#ff00cc">  let s_created = CREATE_MAIN_PROCESS s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 520 </font></span><font color="#ff00cc">      s_created_start = START_MAIN_PROCESS s_created part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 521 </font></span><font color="#ff00cc">  s_created_start&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 522 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 523 </font></span><font color="#006699"><strong>definition</strong></font> partRestartNoSchd <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 524 </font></span>  <font color="#ff00cc">&quot;partRestartNoSchd s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 525 </font></span><font color="#ff00cc">  let s_c_procs = clearProcs s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 526 </font></span><font color="#ff00cc">      s_c_procs_rscs = clearRsrs s_c_procs part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 527 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts = partReInit s_c_procs_rscs part_id True;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 528 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_plmtx = CREATE_PREEMPT_LOCK_MUTEX s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 529 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main = CREATE_START_MAIN_PROCESS s_c_procs_rscs_parts_plmtx part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 530 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main_idle = setCurProc_part s_c_procs_rscs_parts_main part_id IDLE_PROC_ID in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 531 </font></span><font color="#ff00cc">  s_c_procs_rscs_parts_main_idle&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 532 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 533 </font></span><font color="#006699"><strong>fun</strong></font> partsRestartNoSchd <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 534 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; ((PART_OFFSET_TYPE &times; PART_ID_TYPE &times; PART_DURATION_TYPE) list) &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 535 </font></span>  <font color="#ff00cc">&quot;partsRestartNoSchd s pppl =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 536 </font></span><font color="#ff00cc">  (let part_id = fst(snd(pppl!0)); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 537 </font></span><font color="#ff00cc">      s_c_procs = clearProcs s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 538 </font></span><font color="#ff00cc">      s_c_procs_rscs = clearRsrs s_c_procs part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 539 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts = partReInit s_c_procs_rscs part_id True;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 540 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main = CREATE_START_MAIN_PROCESS s_c_procs_rscs_parts part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 541 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main_idle = setCurProc_part s_c_procs_rscs_parts_main part_id IDLE_PROC_ID in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 542 </font></span><font color="#ff00cc">  if pppl = [] then s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 543 </font></span><font color="#ff00cc">  else partsRestartNoSchd s_c_procs_rscs_parts_main_idle (drop 1 pppl))&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 544 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 545 </font></span><font color="#006699"><strong>definition</strong></font> partRestart <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 546 </font></span>  <font color="#ff00cc">&quot;partRestart s core_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 547 </font></span><font color="#ff00cc">  let part_id = the(curPartID s core_id); </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 548 </font></span><font color="#ff00cc">      s_c_procs = clearProcs s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 549 </font></span><font color="#ff00cc">      s_c_procs_rscs = clearRsrs s_c_procs part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 550 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts = partReInit s_c_procs_rscs part_id True;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 551 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main = CREATE_START_MAIN_PROCESS s_c_procs_rscs_parts part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 552 </font></span><font color="#ff00cc">      s_c_procs_rscs_parts_main_idle = setCurProc_part s_c_procs_rscs_parts_main part_id IDLE_PROC_ID in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 553 </font></span><font color="#ff00cc">  schedule_Abs s_c_procs_rscs_parts_main_idle core_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 554 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 555 </font></span><font color="#006699"><strong>definition</strong></font> <font color="#ff00cc">&quot;partStart = partRestart&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 556 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 557 </font></span><font color="#006699"><strong>definition</strong></font> partsOfACoreRestart <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 558 </font></span>  <font color="#ff00cc">&quot;partsOfACoreRestart s core_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 559 </font></span><font color="#ff00cc">  let part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 560 </font></span><font color="#ff00cc">    pppl = the(partsSched conf core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 561 </font></span><font color="#ff00cc">    s_restartParts = partsRestartNoSchd s pppl in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 562 </font></span><font color="#ff00cc">  schedule_Abs s_restartParts core_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 563 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 564 </font></span><font color="#006699"><strong>function</strong></font> setProcsStart' <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 565 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; PROC_ID_TYPE set &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 566 </font></span>  <font color="#ff00cc">&quot;setProcsStart' s part_id  ps =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 567 </font></span><font color="#ff00cc">  (if ps = {} then s</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 568 </font></span><font color="#ff00cc">  else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 569 </font></span><font color="#ff00cc">    let one_procid = SOME proc_id. proc_id &isin; ps;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 570 </font></span><font color="#ff00cc">      proc_sta = the(getProcSta s (part_id, one_procid));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 571 </font></span><font color="#ff00cc">      proc_delayt = the(getDelayT s (part_id, one_procid));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 572 </font></span><font color="#ff00cc">      proc_attr = the(getProcAttr s (part_id, one_procid));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 573 </font></span><font color="#ff00cc">      proc_period = PROC_ATTR_TYPE.PERIOD proc_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 574 </font></span><font color="#ff00cc">      proc_capacity = PROC_ATTR_TYPE.TIME_CAPACITY proc_attr;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 575 </font></span><font color="#ff00cc">      core_id = the(partBlngCore part_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 576 </font></span><font color="#ff00cc">    if proc_sta &ne; WAITING then setProcsStart' s part_id (ps - {one_procid})</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 577 </font></span><font color="#ff00cc">    else</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 578 </font></span><font color="#ff00cc">      if proc_delayt = 0 then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 579 </font></span><font color="#ff00cc">        if proc_period = -1 then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 580 </font></span><font color="#ff00cc">          let s_set_rlsp = setRlsPoint s (part_id, one_procid) (Int.int (sysClk s));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 581 </font></span><font color="#ff00cc">            s_set_rlsp_ddl = setProcDDL s_set_rlsp (part_id, one_procid) (Int.int(sysClk s + Int.nat proc_capacity));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 582 </font></span><font color="#ff00cc">            s_set_rlsp_ddl_rdy = procReady s_set_rlsp_ddl (part_id, one_procid) in s_set_rlsp_ddl_rdy</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 583 </font></span><font color="#ff00cc">        else fst (periodic_wait s core_id)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 584 </font></span><font color="#ff00cc">      else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 585 </font></span><font color="#ff00cc">        if proc_period = -1 then </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 586 </font></span><font color="#ff00cc">          let s_set_rlsp = setRlsPoint s (part_id, one_procid) (Int.int (sysClk s + proc_delayt));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 587 </font></span><font color="#ff00cc">            s_set_rlsp_ddl = setProcDDL s_set_rlsp (part_id, one_procid) (Int.int(sysClk s + proc_delayt + Int.nat proc_capacity));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 588 </font></span><font color="#ff00cc">            s_set_rlsp_ddl_rdy = procReady s_set_rlsp_ddl (part_id, one_procid) in s_set_rlsp_ddl_rdy</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 589 </font></span><font color="#ff00cc">        else fst (periodic_wait s core_id))&quot;</font> <font color="#006699"><strong>by</strong></font> auto
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 590 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 591 </font></span><font color="#006699"><strong>definition</strong></font> setProcsStart <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 592 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; PART_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 593 </font></span>  <font color="#ff00cc">&quot;setProcsStart s part_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 594 </font></span><font color="#ff00cc">  let procs = getProcsOfPart s part_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 595 </font></span><font color="#ff00cc">  setProcsStart' s part_id procs&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 596 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 597 </font></span><font color="#006699"><strong>definition</strong></font> set_part_mode_normal <font color="#000000"><strong>::</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 598 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme&quot;</font>  <font color="#009966"><strong>where</strong></font>  
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 599 </font></span>  <font color="#ff00cc">&quot;set_part_mode_normal s core_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 600 </font></span><font color="#ff00cc">  let part_id = the(curPartID s core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 601 </font></span><font color="#ff00cc">    s_setProcStart = setProcsStart s part_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 602 </font></span><font color="#ff00cc">    s_setProcStart_stopMain = procStop s_setProcStart (part_id, MAIN_PROC_ID) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 603 </font></span><font color="#ff00cc">    schedule_Abs s_setProcStart_stopMain core_id&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 604 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 605 </font></span><font color="#cc0000">(*START*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 606 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 607 </font></span><font color="#006699"><strong>definition</strong></font> partSchedNextTime <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 608 </font></span>  <font color="#ff00cc">&quot;V_CORE_ID_TYPE &rArr; PART_ID_TYPE &rArr; SYSTEM_TIME_TYPE &rArr; SYSTEM_TIME_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 609 </font></span>  <font color="#ff00cc">&quot;partSchedNextTime core_id part_id t =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 610 </font></span><font color="#ff00cc">    (let major_time_fram = MAJOR_TIME_FRAME core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 611 </font></span><font color="#ff00cc">        parts_list = the(partsSched conf core_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 612 </font></span><font color="#ff00cc">        curPartPastTime = (t mod major_time_fram) - fst(parts_list!part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 613 </font></span><font color="#ff00cc">        nextTime = t + (MAJOR_TIME_FRAME core_id) - curPartPastTime</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 614 </font></span><font color="#ff00cc">      in nextTime)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 615 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 616 </font></span><font color="#006699"><strong>definition</strong></font> start <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 617 </font></span>  <font color="#ff00cc">&quot;'a StaProc_scheme &rArr; V_CORE_ID_TYPE &rArr; PROC_ID_TYPE &rArr; 'a StaProc_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 618 </font></span>  <font color="#ff00cc">&quot;start s core_id proc_id =</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 619 </font></span><font color="#ff00cc">   (let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 620 </font></span><font color="#ff00cc">        proc_attr = getProcAttr s (the cur_part_id, proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 621 </font></span><font color="#ff00cc">    if proc_attr = None then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 622 </font></span><font color="#ff00cc">      (s , INVALID_PARAM)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 623 </font></span><font color="#ff00cc">    else if the(getProcSta s (the cur_part_id, proc_id)) &ne; DORMANT then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 624 </font></span><font color="#ff00cc">      (s , NO_ACTION)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 625 </font></span><font color="#ff00cc">    else if isPeriodic s (the cur_part_id, proc_id) = False then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 626 </font></span><font color="#ff00cc">           (let s_set_priority = setPriority s (the cur_part_id, proc_id) (BASE_PRIORITY(the proc_attr));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 627 </font></span><font color="#ff00cc">                s_reset_procCn = resetCntxt s_set_priority (the cur_part_id, proc_id)  in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 628 </font></span><font color="#ff00cc">               if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 629 </font></span><font color="#ff00cc">                  (let s_toReay = procReady s_reset_procCn (the cur_part_id, proc_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 630 </font></span><font color="#ff00cc">                       s_toReay_ddl = case TIME_CAPACITY(the proc_attr)&gt;0 of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 631 </font></span><font color="#ff00cc">                                            True &rArr; setProcDDL s_toReay (the cur_part_id, proc_id) (Int.int(timer_'  s_toReay + Int.nat(TIME_CAPACITY(the proc_attr)))) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 632 </font></span><font color="#ff00cc">                                             False &rArr; s_toReay in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 633 </font></span><font color="#ff00cc">                  (schedule_Abs s_toReay_ddl core_id , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 634 </font></span><font color="#ff00cc">               else (let s_set_waiting = setProcSta s_reset_procCn (the cur_part_id, proc_id) WAITING in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 635 </font></span><font color="#ff00cc">                        (s_set_waiting, NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 636 </font></span><font color="#ff00cc">             )   </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 637 </font></span><font color="#ff00cc">    else </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 638 </font></span><font color="#ff00cc">        (let s_set_priority = setPriority s (the cur_part_id, proc_id) (BASE_PRIORITY(the(proc_attr)));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 639 </font></span><font color="#ff00cc">            s_reset_procCn = resetCntxt s_set_priority (the cur_part_id, proc_id) in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 640 </font></span><font color="#ff00cc">            if getPartMode s (the cur_part_id) = Some NORMAL then</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 641 </font></span><font color="#ff00cc">               (let set_waiting = setProcSta s_reset_procCn (the cur_part_id, proc_id) WAITING;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 642 </font></span><font color="#ff00cc">                  firstRls = partSchedNextTime core_id (the cur_part_id) (int(timer_' set_waiting));</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 643 </font></span><font color="#ff00cc">                  s_set_firstRls = setRlsPoint set_waiting (the cur_part_id, proc_id) firstRls;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 644 </font></span><font color="#ff00cc">                  s_set_firstRls_ddl = case TIME_CAPACITY(the proc_attr)&gt;0 of </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 645 </font></span><font color="#ff00cc">                                            True &rArr; setProcDDL s_set_firstRls (the cur_part_id, proc_id) (Int.int(Int.nat(TIME_CAPACITY(the proc_attr)) + Int.nat(firstRls))) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 646 </font></span><font color="#ff00cc">                                             False &rArr; s_set_firstRls  in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 647 </font></span><font color="#ff00cc">               (s_set_firstRls_ddl , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 648 </font></span><font color="#ff00cc">            else (let s_set_waiting = setProcSta s_reset_procCn (the cur_part_id, proc_id) WAITING in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 649 </font></span><font color="#ff00cc">                        (s_set_waiting , NO_ERROR))</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 650 </font></span><font color="#ff00cc">        )</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 651 </font></span><font color="#ff00cc">)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 652 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 653 </font></span><font color="#cc0000">(*hm*)</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 654 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 655 </font></span><font color="#006699"><strong>definition</strong></font> packRptError <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 656 </font></span>  <font color="#ff00cc">&quot;PROC_ERROR_CODE_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; string &rArr; REPORTED_ERROR_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 657 </font></span>  <font color="#ff00cc">&quot;packRptError error pp str &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 658 </font></span><font color="#ff00cc">  &#10631;errorType = error,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 659 </font></span><font color="#ff00cc">  errorProcID = pp,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 660 </font></span><font color="#ff00cc">  errorMsg = str,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 661 </font></span><font color="#ff00cc">  errorMsgSz = length str&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 662 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 663 </font></span><font color="#006699"><strong>definition</strong></font> packDectError <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;PROC_ERROR_CODE_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; REPORTED_ERROR_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 664 </font></span>  <font color="#ff00cc">&quot;packDectError proc_error pp &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 665 </font></span><font color="#ff00cc">  &#10631;errorType = proc_error,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 666 </font></span><font color="#ff00cc">  errorProcID =  pp,</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 667 </font></span><font color="#ff00cc">  errorMsg = ''REPORTED ERROR MESSAGE'',</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 668 </font></span><font color="#ff00cc">  errorMsgSz = length (''REPORTED ERROR MESSAGE'')&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 669 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 670 </font></span><font color="#006699"><strong>primrec</strong></font> createReportedError <font color="#000000"><strong>::</strong></font> <font color="#ff00cc">&quot;DETECTED_ERROR_TYPE &rArr; PART_ID_TYPE &times; PROC_ID_TYPE &rArr; REPORTED_ERROR_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 671 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.DEADLINE_MISSED) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 672 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.DEADLINE_MISSED) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 673 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.APP_ERROR) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 674 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.APP_ERROR) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 675 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.NUMERIC_ERROR) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 676 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.NUMERIC_ERROR) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 677 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.ILLEGAL_REQ) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 678 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.ILLEGAL_REQ) proc_id)&quot;</font>  <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 679 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.STACK_OVER) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 680 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.STACK_OVER) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 681 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.MEMORY_VIO) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 682 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.MEMORY_VIO) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 683 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.HARDWARE_FAULT) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 684 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.HARDWARE_FAULT) proc_id)&quot;</font> <font color="#000000"><strong>|</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 685 </font></span>  <font color="#ff00cc">&quot;createReportedError (DETECTED_ERROR_TYPE.POWER_FAIL) proc_id = </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 686 </font></span><font color="#ff00cc">    (packDectError (PROC_ERROR_CODE_TYPE.POWER_FAIL) proc_id)&quot;</font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 687 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 688 </font></span><font color="#006699"><strong>definition</strong></font> insertReportedError <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 689 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; DETECTED_ERROR_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 690 </font></span>  <font color="#ff00cc">&quot;insertReportedError s core_id detected_error &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 691 </font></span><font color="#ff00cc">  let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 692 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 693 </font></span><font color="#ff00cc">      reported_error = createReportedError detected_error (the cur_part_id, the cur_proc_id) in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 694 </font></span><font color="#ff00cc">  s&#10631;hm_' := (hm_' s)&#10631;errorList := (errorList(hm_' s))((the cur_part_id) := Some reported_error)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 695 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 696 </font></span><font color="#006699"><strong>definition</strong></font> deleteReportedErro <font color="#000000"><strong>::</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 697 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; 'a STATE_scheme&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 698 </font></span>  <font color="#ff00cc">&quot;deleteReportedErro s core_id &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 699 </font></span><font color="#ff00cc">  let cur_part_id = curPartID s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 700 </font></span><font color="#ff00cc">  s&#10631;hm_' := (hm_' s)&#10631;errorList := (errorList(hm_' s))((the cur_part_id) := None)&#10632;&#10632;&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 701 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 702 </font></span><font color="#006699"><strong>definition</strong></font> hmDetectedError_ProcAct <font color="#000000"><strong>::</strong></font> 
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 703 </font></span>  <font color="#ff00cc">&quot;'a STATE_scheme &rArr; V_CORE_ID_TYPE &rArr; DETECTED_ERROR_TYPE &rArr; 'a STATE_scheme &times; RETURN_CODE_TYPE&quot;</font> <font color="#009966"><strong>where</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 704 </font></span>  <font color="#ff00cc">&quot;hmDetectedError_ProcAct s core_id error &equiv;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 705 </font></span><font color="#ff00cc">  let cur_part_id = curPartID s core_id;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 706 </font></span><font color="#ff00cc">      cur_proc_id = curProcID_Core s core_id in</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 707 </font></span><font color="#ff00cc">  case error of</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 708 </font></span><font color="#ff00cc">    MODULE_ERROR0 &rArr; (partsOfACoreRestart s core_id, NO_ERROR) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 709 </font></span><font color="#ff00cc">    PART_ERROR0 &rArr; (partRestart s core_id, NO_ERROR) |</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 710 </font></span><font color="#ff00cc">    proc_error &rArr; </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 711 </font></span><font color="#ff00cc">      let s_insertErr = insertReportedError s core_id proc_error;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 712 </font></span><font color="#ff00cc">        s_setError_called = setHMCalled s_insertErr (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 713 </font></span><font color="#ff00cc">        s_setError_calledStaus = setHMCalled s_setError_called (the cur_part_id);</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 714 </font></span><font color="#ff00cc">        s_insertErr_startHM = start s_setError_calledStaus core_id HM_PROC_ID in </font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff990066"> 715 </font></span><font color="#ff00cc">      (schedule_Abs (fst s_insertErr_startHM) core_id, NO_ERROR)&quot;</font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 716 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 717 </font></span>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 718 </font></span><font color="#009966"><strong>end</strong></font>
<span style="background:#ffffffff; border-right:solid 2px black; margin-right:5px; "><font color="#ff000000"> 719 </font></span>
</font></pre>
</body>
</html>
